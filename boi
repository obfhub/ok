--// MinimalUI.lua
--// Minimalistic Roblox UI Library (Tabs + Button/Toggle/Dropdown/Slider/Keybind)
--// Usage example at bottom.

local UIS = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")

local Library = {}
Library.__index = Library

-- =========================
-- Helpers
-- =========================
local function tween(obj, t, props)
	local info = TweenInfo.new(t, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
	TweenService:Create(obj, info, props):Play()
end

local function make(class, props)
	local inst = Instance.new(class)
	for k, v in pairs(props or {}) do
		inst[k] = v
	end
	return inst
end

local function round(n, step)
	step = step or 1
	return math.floor((n / step) + 0.5) * step
end

-- =========================
-- Theme
-- =========================
local Theme = {
	BG = Color3.fromRGB(18, 18, 18),
	Panel = Color3.fromRGB(24, 24, 24),
	Stroke = Color3.fromRGB(38, 38, 38),
	Text = Color3.fromRGB(235, 235, 235),
	Muted = Color3.fromRGB(170, 170, 170),
	Accent = Color3.fromRGB(140, 120, 255),

	Control = Color3.fromRGB(28, 28, 28),
	ControlHover = Color3.fromRGB(32, 32, 32),
}

local function addStroke(gui, transparency)
	local s = Instance.new("UIStroke")
	s.Color = Theme.Stroke
	s.Thickness = 1
	s.Transparency = transparency or 0
	s.Parent = gui
	return s
end

local function addCorner(gui, radius)
	local c = Instance.new("UICorner")
	c.CornerRadius = UDim.new(0, radius or 8)
	c.Parent = gui
	return c
end

local function addPadding(gui, pad)
	local p = Instance.new("UIPadding")
	p.PaddingLeft = UDim.new(0, pad or 10)
	p.PaddingRight = UDim.new(0, pad or 10)
	p.PaddingTop = UDim.new(0, pad or 10)
	p.PaddingBottom = UDim.new(0, pad or 10)
	p.Parent = gui
	return p
end

local function textSize(label)
	label.TextSize = 13
	label.Font = Enum.Font.Gotham
end

local function makeControl(parent, height)
	local frame = make("Frame", {
		Parent = parent,
		BackgroundColor3 = Theme.Control,
		Size = UDim2.new(1, 0, 0, height or 36),
		BorderSizePixel = 0,
	})
	addCorner(frame, 8)
	addStroke(frame, 0)

	local hit = make("TextButton", {
		Parent = frame,
		BackgroundTransparency = 1,
		Text = "",
		Size = UDim2.fromScale(1, 1),
		AutoButtonColor = false,
	})
	hit.MouseEnter:Connect(function() tween(frame, 0.12, {BackgroundColor3 = Theme.ControlHover}) end)
	hit.MouseLeave:Connect(function() tween(frame, 0.12, {BackgroundColor3 = Theme.Control}) end)

	return frame, hit
end

local function makeLabel(parent, txt)
	local l = make("TextLabel", {
		Parent = parent,
		BackgroundTransparency = 1,
		Text = txt or "",
		TextColor3 = Theme.Text,
		TextXAlignment = Enum.TextXAlignment.Left,
		Size = UDim2.new(1, 0, 1, 0),
	})
	textSize(l)
	return l
end

local function makeSmallLabel(parent, txt)
	local l = make("TextLabel", {
		Parent = parent,
		BackgroundTransparency = 1,
		Text = txt or "",
		TextColor3 = Theme.Muted,
		TextXAlignment = Enum.TextXAlignment.Right,
		Size = UDim2.new(0, 120, 1, 0),
	})
	l.Font = Enum.Font.Gotham
	l.TextSize = 12
	return l
end

-- =========================
-- Window
-- =========================
function Library:CreateWindow(opts)
	opts = opts or {}
	local title = opts.Title or "MinimalUI"
	local parent = opts.Parent or game:GetService("CoreGui")

	local screen = make("ScreenGui", {
		Name = "MinimalUI_" .. tostring(math.random(1000, 9999)),
		Parent = parent,
		ResetOnSpawn = false,
		ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
	})

	local main = make("Frame", {
		Parent = screen,
		BackgroundColor3 = Theme.BG,
		Size = UDim2.new(0, 520, 0, 360),
		Position = UDim2.new(0.5, -260, 0.5, -180),
		BorderSizePixel = 0,
	})
	addCorner(main, 12)
	addStroke(main, 0)

	local top = make("Frame", {
		Parent = main,
		BackgroundColor3 = Theme.Panel,
		Size = UDim2.new(1, 0, 0, 44),
		BorderSizePixel = 0,
	})
	addCorner(top, 12)
	addStroke(top, 0)

	-- Fix corner overlap (top only)
	local cover = make("Frame", {
		Parent = top,
		BackgroundColor3 = Theme.Panel,
		BorderSizePixel = 0,
		Size = UDim2.new(1, 0, 0, 12),
		Position = UDim2.new(0, 0, 1, -12),
	})
	cover.ZIndex = top.ZIndex

	local titleLabel = make("TextLabel", {
		Parent = top,
		BackgroundTransparency = 1,
		Text = title,
		TextColor3 = Theme.Text,
		TextXAlignment = Enum.TextXAlignment.Left,
		Size = UDim2.new(1, -20, 1, 0),
		Position = UDim2.new(0, 12, 0, 0),
	})
	titleLabel.Font = Enum.Font.GothamSemibold
	titleLabel.TextSize = 14

	-- Drag
	do
		local dragging, dragStart, startPos
		top.InputBegan:Connect(function(input)
			if input.UserInputType == Enum.UserInputType.MouseButton1 then
				dragging = true
				dragStart = input.Position
				startPos = main.Position
			end
		end)
		UIS.InputChanged:Connect(function(input)
			if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
				local delta = input.Position - dragStart
				main.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
			end
		end)
		UIS.InputEnded:Connect(function(input)
			if input.UserInputType == Enum.UserInputType.MouseButton1 then
				dragging = false
			end
		end)
	end

	local body = make("Frame", {
		Parent = main,
		BackgroundTransparency = 1,
		Size = UDim2.new(1, 0, 1, -44),
		Position = UDim2.new(0, 0, 0, 44),
	})

	local tabsBar = make("Frame", {
		Parent = body,
		BackgroundColor3 = Theme.Panel,
		Size = UDim2.new(0, 150, 1, 0),
		BorderSizePixel = 0,
	})
	addStroke(tabsBar, 0)

	local tabsList = make("UIListLayout", {
		Parent = tabsBar,
		SortOrder = Enum.SortOrder.LayoutOrder,
		Padding = UDim.new(0, 6),
	})
	addPadding(tabsBar, 10)

	local pages = make("Frame", {
		Parent = body,
		BackgroundTransparency = 1,
		Size = UDim2.new(1, -150, 1, 0),
		Position = UDim2.new(0, 150, 0, 0),
	})

	local window = {
		ScreenGui = screen,
		Main = main,
		TabsBar = tabsBar,
		Pages = pages,
		Tabs = {},
		CurrentTab = nil,
		_Keybinds = {}, -- { [Enum.KeyCode] = callback }
	}
	setmetatable(window, self)

	-- Global keybind listener (per window)
	UIS.InputBegan:Connect(function(input, gp)
		if gp then return end
		if input.KeyCode and window._Keybinds[input.KeyCode] then
			window._Keybinds[input.KeyCode]()
		end
	end)

	function window:Destroy()
		if self.ScreenGui then
			self.ScreenGui:Destroy()
		end
	end

	function window:AddTab(name)
		local tab = {}
		tab.Name = name

		local tabBtn = make("TextButton", {
			Parent = tabsBar,
			BackgroundColor3 = Theme.Control,
			Size = UDim2.new(1, 0, 0, 34),
			BorderSizePixel = 0,
			Text = "",
			AutoButtonColor = false,
		})
		addCorner(tabBtn, 8)
		addStroke(tabBtn, 0)

		local tabText = make("TextLabel", {
			Parent = tabBtn,
			BackgroundTransparency = 1,
			Text = name,
			TextColor3 = Theme.Text,
			TextXAlignment = Enum.TextXAlignment.Left,
			Size = UDim2.new(1, -20, 1, 0),
			Position = UDim2.new(0, 10, 0, 0),
		})
		textSize(tabText)

		local page = make("ScrollingFrame", {
			Parent = pages,
			BackgroundTransparency = 1,
			Size = UDim2.fromScale(1, 1),
			CanvasSize = UDim2.new(0, 0, 0, 0),
			ScrollBarThickness = 4,
			Visible = false,
		})
		page.ScrollBarImageTransparency = 0.3

		local layout = make("UIListLayout", {
			Parent = page,
			SortOrder = Enum.SortOrder.LayoutOrder,
			Padding = UDim.new(0, 8),
		})
		addPadding(page, 12)

		layout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
			page.CanvasSize = UDim2.new(0, 0, 0, layout.AbsoluteContentSize.Y + 16)
		end)

		tab.Button = tabBtn
		tab.Page = page
		tab.Layout = layout

		function tab:SetActive(active)
			tab.Page.Visible = active
			if active then
				tween(tabBtn, 0.12, {BackgroundColor3 = Theme.ControlHover})
				addStroke(tabBtn, 0).Color = Theme.Accent -- subtle accent stroke
			else
				tween(tabBtn, 0.12, {BackgroundColor3 = Theme.Control})
				-- remove extra strokes if any (keep 1 base)
				for _, c in ipairs(tabBtn:GetChildren()) do
					if c:IsA("UIStroke") then
						c.Color = Theme.Stroke
					end
				end
			end
		end

		tabBtn.MouseButton1Click:Connect(function()
			if window.CurrentTab == tab then return end
			if window.CurrentTab then window.CurrentTab:SetActive(false) end
			window.CurrentTab = tab
			tab:SetActive(true)
		end)

		-- Controls API
		function tab:AddButton(opts)
			opts = opts or {}
			local text = opts.Text or "Button"
			local cb = opts.Callback or function() end

			local frame, hit = makeControl(page, 36)

			local l = makeLabel(frame, text)
			l.Position = UDim2.new(0, 10, 0, 0)
			l.Size = UDim2.new(1, -20, 1, 0)

			hit.MouseButton1Click:Connect(function()
				cb()
			end)

			return {
				SetText = function(_, t) l.Text = t end
			}
		end

		function tab:AddToggle(opts)
			opts = opts or {}
			local text = opts.Text or "Toggle"
			local state = opts.Default == true
			local cb = opts.Callback or function(_) end

			local frame, hit = makeControl(page, 36)

			local l = makeLabel(frame, text)
			l.Position = UDim2.new(0, 10, 0, 0)
			l.Size = UDim2.new(1, -60, 1, 0)

			local box = make("Frame", {
				Parent = frame,
				BackgroundColor3 = Theme.Panel,
				Size = UDim2.new(0, 34, 0, 18),
				Position = UDim2.new(1, -44, 0.5, -9),
				BorderSizePixel = 0,
			})
			addCorner(box, 9)
			addStroke(box, 0)

			local knob = make("Frame", {
				Parent = box,
				BackgroundColor3 = Theme.Muted,
				Size = UDim2.new(0, 14, 0, 14),
				Position = UDim2.new(0, 2, 0.5, -7),
				BorderSizePixel = 0,
			})
			addCorner(knob, 7)

			local function render(v)
				state = v
				if state then
					tween(knob, 0.12, {Position = UDim2.new(1, -16, 0.5, -7), BackgroundColor3 = Theme.Accent})
					tween(box, 0.12, {BackgroundColor3 = Theme.ControlHover})
				else
					tween(knob, 0.12, {Position = UDim2.new(0, 2, 0.5, -7), BackgroundColor3 = Theme.Muted})
					tween(box, 0.12, {BackgroundColor3 = Theme.Panel})
				end
				cb(state)
			end

			render(state)

			hit.MouseButton1Click:Connect(function()
				render(not state)
			end)

			return {
				Set = function(_, v) render(v == true) end,
				Get = function() return state end
			}
		end

		function tab:AddDropdown(opts)
			opts = opts or {}
			local text = opts.Text or "Dropdown"
			local items = opts.Items or {}
			local value = opts.Default
			local cb = opts.Callback or function(_) end

			local open = false

			local frame, hit = makeControl(page, 40)

			local left = make("Frame", {
				Parent = frame,
				BackgroundTransparency = 1,
				Size = UDim2.new(1, -20, 1, 0),
				Position = UDim2.new(0, 10, 0, 0),
			})

			local titleLabel = make("TextLabel", {
				Parent = left,
				BackgroundTransparency = 1,
				Text = text,
				TextColor3 = Theme.Text,
				TextXAlignment = Enum.TextXAlignment.Left,
				Size = UDim2.new(1, 0, 0, 18),
				Position = UDim2.new(0, 0, 0, 4),
			})
			titleLabel.Font = Enum.Font.Gotham
			titleLabel.TextSize = 13

			local valueLabel = make("TextLabel", {
				Parent = left,
				BackgroundTransparency = 1,
				Text = value and tostring(value) or "Select...",
				TextColor3 = Theme.Muted,
				TextXAlignment = Enum.TextXAlignment.Left,
				Size = UDim2.new(1, 0, 0, 16),
				Position = UDim2.new(0, 0, 0, 20),
			})
			valueLabel.Font = Enum.Font.Gotham
			valueLabel.TextSize = 12

			local caret = make("TextLabel", {
				Parent = frame,
				BackgroundTransparency = 1,
				Text = "▾",
				TextColor3 = Theme.Muted,
				Size = UDim2.new(0, 20, 0, 20),
				Position = UDim2.new(1, -26, 0.5, -10),
			})
			caret.Font = Enum.Font.GothamSemibold
			caret.TextSize = 14

			local listWrap = make("Frame", {
				Parent = page,
				BackgroundColor3 = Theme.Control,
				BorderSizePixel = 0,
				Visible = false,
				Size = UDim2.new(1, 0, 0, 0),
			})
			addCorner(listWrap, 8)
			addStroke(listWrap, 0)

			local list = make("UIListLayout", {
				Parent = listWrap,
				SortOrder = Enum.SortOrder.LayoutOrder,
				Padding = UDim.new(0, 6),
			})
			addPadding(listWrap, 8)

			local function rebuild()
				for _, c in ipairs(listWrap:GetChildren()) do
					if c:IsA("TextButton") then c:Destroy() end
				end
				for i, item in ipairs(items) do
					local b = make("TextButton", {
						Parent = listWrap,
						BackgroundColor3 = Theme.Panel,
						BorderSizePixel = 0,
						Size = UDim2.new(1, 0, 0, 28),
						Text = tostring(item),
						TextColor3 = Theme.Text,
						AutoButtonColor = false,
					})
					b.Font = Enum.Font.Gotham
					b.TextSize = 12
					addCorner(b, 6)

					b.MouseEnter:Connect(function() tween(b, 0.12, {BackgroundColor3 = Theme.ControlHover}) end)
					b.MouseLeave:Connect(function() tween(b, 0.12, {BackgroundColor3 = Theme.Panel}) end)

					b.MouseButton1Click:Connect(function()
						value = item
						valueLabel.Text = tostring(item)
						cb(item)
						open = false
						listWrap.Visible = false
						caret.Text = "▾"
					end)
				end
			end

			rebuild()

			local function setOpen(v)
				open = v
				listWrap.Visible = open
				caret.Text = open and "▴" or "▾"
				if open then
					-- compute size
					task.defer(function()
						local h = list.AbsoluteContentSize.Y + 16
						listWrap.Size = UDim2.new(1, 0, 0, h)
					end)
				end
			end

			hit.MouseButton1Click:Connect(function()
				setOpen(not open)
			end)

			return {
				SetItems = function(_, newItems)
					items = newItems or {}
					rebuild()
					if open then setOpen(true) end
				end,
				Set = function(_, v)
					value = v
					valueLabel.Text = v and tostring(v) or "Select..."
					cb(value)
				end,
				Get = function() return value end
			}
		end

		function tab:AddSlider(opts)
			opts = opts or {}
			local text = opts.Text or "Slider"
			local min = opts.Min or 0
			local max = opts.Max or 100
			local step = opts.Step or 1
			local value = opts.Default or min
			local cb = opts.Callback or function(_) end

			local frame, _ = makeControl(page, 54)

			local title = make("TextLabel", {
				Parent = frame,
				BackgroundTransparency = 1,
				Text = text,
				TextColor3 = Theme.Text,
				TextXAlignment = Enum.TextXAlignment.Left,
				Size = UDim2.new(1, -120, 0, 18),
				Position = UDim2.new(0, 10, 0, 6),
			})
			title.Font = Enum.Font.Gotham
			title.TextSize = 13

			local valLabel = makeSmallLabel(frame, tostring(value))
			valLabel.Position = UDim2.new(1, -130, 0, 6)
			valLabel.Size = UDim2.new(0, 120, 0, 18)

			local bar = make("Frame", {
				Parent = frame,
				BackgroundColor3 = Theme.Panel,
				BorderSizePixel = 0,
				Size = UDim2.new(1, -20, 0, 10),
				Position = UDim2.new(0, 10, 0, 34),
			})
			addCorner(bar, 8)
			addStroke(bar, 0)

			local fill = make("Frame", {
				Parent = bar,
				BackgroundColor3 = Theme.Accent,
				BorderSizePixel = 0,
				Size = UDim2.new(0, 0, 1, 0),
			})
			addCorner(fill, 8)

			local dragging = false

			local function set(v, fire)
				v = math.clamp(v, min, max)
				v = round(v, step)
				value = v

				valLabel.Text = tostring(value)

				local alpha = (value - min) / (max - min)
				fill.Size = UDim2.new(alpha, 0, 1, 0)

				if fire ~= false then
					cb(value)
				end
			end

			set(value, false)

			local function updateFromMouse(x)
				local absPos = bar.AbsolutePosition.X
				local absSize = bar.AbsoluteSize.X
				local alpha = math.clamp((x - absPos) / absSize, 0, 1)
				local v = min + (max - min) * alpha
				set(v, true)
			end

			bar.InputBegan:Connect(function(input)
				if input.UserInputType == Enum.UserInputType.MouseButton1 then
					dragging = true
					updateFromMouse(input.Position.X)
				end
			end)
			UIS.InputChanged:Connect(function(input)
				if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
					updateFromMouse(input.Position.X)
				end
			end)
			UIS.InputEnded:Connect(function(input)
				if input.UserInputType == Enum.UserInputType.MouseButton1 then
					dragging = false
				end
			end)

			return {
				Set = function(_, v) set(v, true) end,
				Get = function() return value end
			}
		end

		function tab:AddKeybind(opts)
			opts = opts or {}
			local text = opts.Text or "Keybind"
			local defaultKey = opts.DefaultKey or Enum.KeyCode.RightShift
			local cb = opts.Callback or function() end

			local key = defaultKey
			local listening = false

			local frame, hit = makeControl(page, 36)

			local l = makeLabel(frame, text)
			l.Position = UDim2.new(0, 10, 0, 0)
			l.Size = UDim2.new(1, -160, 1, 0)

			local keyBtn = make("TextButton", {
				Parent = frame,
				BackgroundColor3 = Theme.Panel,
				BorderSizePixel = 0,
				Size = UDim2.new(0, 130, 0, 24),
				Position = UDim2.new(1, -140, 0.5, -12),
				Text = key.Name,
				TextColor3 = Theme.Text,
				AutoButtonColor = false,
			})
			keyBtn.Font = Enum.Font.Gotham
			keyBtn.TextSize = 12
			addCorner(keyBtn, 6)
			addStroke(keyBtn, 0)

			local function setKey(newKey)
				-- remove old
				window._Keybinds[key] = nil
				key = newKey
				keyBtn.Text = key.Name
				-- add new
				window._Keybinds[key] = cb
			end

			-- register default
			window._Keybinds[key] = cb

			keyBtn.MouseButton1Click:Connect(function()
				if listening then return end
				listening = true
				keyBtn.Text = "Press a key..."
				keyBtn.TextColor3 = Theme.Muted

				local conn
				conn = UIS.InputBegan:Connect(function(input, gp)
					if gp then return end
					if input.KeyCode and input.KeyCode ~= Enum.KeyCode.Unknown then
						if conn then conn:Disconnect() end
						listening = false
						keyBtn.TextColor3 = Theme.Text
						setKey(input.KeyCode)
					end
				end)
			end)

			-- clicking the whole row triggers the bind too (optional)
			hit.MouseButton1Click:Connect(function()
				cb()
			end)

			return {
				SetKey = function(_, k) setKey(k) end,
				GetKey = function() return key end
			}
		end

		table.insert(window.Tabs, tab)

		-- auto-first tab
		if not window.CurrentTab then
			window.CurrentTab = tab
			tab:SetActive(true)
		end

		return tab
	end

	return window
end

return Library

--[[ =========================
Example usage:

local UI = require(path.to.MinimalUI)

local win = UI:CreateWindow({Title = "Demo UI"})
local tab = win:AddTab("Main")

tab:AddButton({
	Text = "Hello",
	Callback = function()
		print("clicked")
	end
})

local t = tab:AddToggle({
	Text = "Enable Feature",
	Default = false,
	Callback = function(v)
		print("toggle:", v)
	end
})

tab:AddDropdown({
	Text = "Select Mode",
	Items = {"Legit", "Rage", "Custom"},
	Default = "Legit",
	Callback = function(v)
		print("dropdown:", v)
	end
})

tab:AddSlider({
	Text = "Speed",
	Min = 0,
	Max = 200,
	Step = 5,
	Default = 50,
	Callback = function(v)
		print("slider:", v)
	end
})

tab:AddKeybind({
	Text = "Do Action",
	DefaultKey = Enum.KeyCode.RightShift,
	Callback = function()
		print("Keybind fired!")
	end
})

========================= ]]
